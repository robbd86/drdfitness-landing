<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DRD Cut Controller | DRD Fitness</title>
  <meta name="description" content="DRD Cut Controller ‚Äî your weekly fat loss decision engine with adjustable targets and personalized macros." />
  <link rel="canonical" href="https://drdfitness.co.uk/cut-controller" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí™</text></svg>" />
  <style>
    :root {
      --primary-color: #FF6B35;
      --secondary-color: #004E89;
      --accent-color: #1A659E;
      --dark-bg: #1A1A1D;
      --light-bg: #F5F5F5;
      --text-dark: #2C2C2C;
      --text-light: #FFFFFF;
    }
  </style>
</head>
<body class="bg-[var(--light-bg)] text-[var(--text-dark)] font-sans">
  <nav class="bg-[var(--dark-bg)] text-white sticky top-0 z-50 shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="/" class="text-xl font-extrabold text-[var(--primary-color)]">DRD FITNESS</a>
      <div class="hidden md:flex items-center gap-6 text-sm font-semibold">
        <a href="/workouts/workout-builder" class="hover:text-[var(--primary-color)]">Workout Builder</a>
        <a href="/supplements" class="hover:text-[var(--primary-color)]">Supplements</a>
        <a href="/blog/fitness-confidence-2026" class="hover:text-[var(--primary-color)]">Blog</a>
        <a href="/gear" class="hover:text-[var(--primary-color)]">My Gear</a>
        <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=nav&utm_campaign=cut-controller" class="bg-[var(--primary-color)] text-white px-4 py-2 rounded-md font-bold hover:shadow">Open App</a>
      </div>
      <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=nav-mobile&utm_campaign=cut-controller" class="md:hidden bg-[var(--primary-color)] text-white px-4 py-2 rounded-md font-bold">Open App</a>
    </div>
  </nav>

  <main>
    <section class="bg-gradient-to-br from-[var(--secondary-color)] to-[var(--accent-color)] text-white">
      <div class="max-w-6xl mx-auto px-6 py-20 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">DRD Cut Controller</h1>
        <p class="mt-4 text-lg md:text-xl text-white/90">Your weekly fat loss decision engine</p>
        <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
          <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=hero&utm_campaign=cut-controller" class="bg-[var(--primary-color)] text-white px-6 py-3 rounded-md font-bold hover:shadow-lg">Start Free</a>
          <a href="#pricing" class="border-2 border-white text-white px-6 py-3 rounded-md font-bold hover:bg-white hover:text-[var(--secondary-color)]">Upgrade for Pro</a>
        </div>
      </div>
    </section>

    <section class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <h2 class="text-3xl font-extrabold text-center text-[var(--secondary-color)]">Built for real progress</h2>
        <p class="mt-3 text-center text-gray-600">Simple guidance that keeps your cut moving without overthinking.</p>
        <div class="mt-10 grid gap-6 md:grid-cols-3">
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="text-3xl">üßÆ</div>
            <h3 class="mt-4 text-xl font-bold text-[var(--secondary-color)]">Calculator</h3>
            <p class="mt-2 text-gray-600">Plug in your stats and goals to get a clear weekly baseline.</p>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="text-3xl">üìà</div>
            <h3 class="mt-4 text-xl font-bold text-[var(--secondary-color)]">Weekly adjusted targets</h3>
            <p class="mt-2 text-gray-600">Auto-adjust calories based on real weigh-ins and trend data.</p>
          </div>
          <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="text-3xl">ü•ó</div>
            <h3 class="mt-4 text-xl font-bold text-[var(--secondary-color)]">Personalized macros</h3>
            <p class="mt-2 text-gray-600">Protein-first macro splits you can actually stick to.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <h2 class="text-3xl font-extrabold text-center text-[var(--secondary-color)]">Get your weekly targets</h2>
        <p class="mt-3 text-center text-gray-600">Enter your stats and we‚Äôll calculate a clear weekly plan.</p>

        <div class="mt-10 grid gap-8 lg:grid-cols-[1.1fr_0.9fr] items-start">
          <form id="cutControllerForm" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="grid gap-4 md:grid-cols-2">
              <label class="text-sm font-semibold text-gray-700">
                Sex
                <select id="sex" name="sex" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2">
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </label>
              <label class="text-sm font-semibold text-gray-700">
                Age
                <input id="age" name="age" type="number" min="13" max="99" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" placeholder="e.g. 30" required />
              </label>
              <label class="text-sm font-semibold text-gray-700">
                Height (cm)
                <input id="height" name="height" type="number" min="120" max="230" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" placeholder="e.g. 175" required />
              </label>
              <label class="text-sm font-semibold text-gray-700">
                Weight (kg)
                <input id="weight" name="weight" type="number" min="35" max="250" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" placeholder="e.g. 78" required />
              </label>
              <label class="text-sm font-semibold text-gray-700">
                Activity level
                <select id="activityLevel" name="activity_level" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" required>
                  <option value="sedentary">Sedentary</option>
                  <option value="light">Light</option>
                  <option value="moderate" selected>Moderate</option>
                  <option value="active">Active</option>
                  <option value="athlete">Athlete</option>
                </select>
              </label>
              <label class="text-sm font-semibold text-gray-700">
                Training days / week
                <input id="trainingDays" name="training_days_per_week" type="number" min="0" max="7" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" placeholder="e.g. 4" required />
              </label>
              <label class="text-sm font-semibold text-gray-700 md:col-span-2">
                Steps per day
                <input id="steps" name="steps_per_day" type="number" min="0" max="40000" class="mt-1 w-full rounded-md border border-gray-200 px-3 py-2" placeholder="e.g. 8000" required />
              </label>
            </div>
            <div class="mt-6 flex flex-col sm:flex-row gap-3">
              <button type="submit" class="bg-[var(--primary-color)] text-white px-6 py-3 rounded-md font-bold hover:shadow">Calculate</button>
              <button type="reset" class="border-2 border-[var(--secondary-color)] text-[var(--secondary-color)] px-6 py-3 rounded-md font-bold">Reset</button>
            </div>
            <p id="formStatus" class="mt-3 text-sm text-gray-500"></p>
          </form>

          <div id="resultsCard" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 opacity-0 translate-y-2 transition-all duration-300">
            <h3 class="text-xl font-bold text-[var(--secondary-color)]">Your weekly targets</h3>
            <p class="mt-2 text-gray-600">Results update based on your inputs.</p>

            <div class="mt-6 grid gap-4">
              <div class="rounded-lg border border-gray-100 bg-gray-50 p-4">
                <div class="text-xs uppercase tracking-wide text-gray-500">Target calories</div>
                <div class="mt-1 text-2xl font-extrabold text-gray-900" id="targetCalories">‚Äî</div>
              </div>
              <div class="rounded-lg border border-gray-100 bg-gray-50 p-4">
                <div class="text-xs uppercase tracking-wide text-gray-500">Weekly loss target</div>
                <div class="mt-1 text-2xl font-extrabold text-gray-900" id="weeklyLoss">‚Äî</div>
              </div>

              <div class="rounded-lg border border-gray-100 bg-white p-4 shadow-sm">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="text-xs uppercase tracking-wide text-gray-400">Your action plan this week</div>
                    <div class="text-lg font-bold text-[var(--secondary-color)]">Do these 3 things</div>
                  </div>
                  <span class="text-xs font-semibold px-2 py-1 rounded-full bg-[var(--secondary-color)]/10 text-[var(--secondary-color)]">Weekly</span>
                </div>
                <ul class="mt-4 space-y-2 text-sm text-gray-700 list-disc pl-5">
                  <li id="actionPlanCalories">Daily calorie target: ‚Äî</li>
                  <li id="actionPlanWeeklyChange">Expected weekly weight change: ‚Äî</li>
                  <li id="actionPlanAdjust">If progress stalls: ‚Äî</li>
                </ul>
                <p class="mt-3 text-xs text-gray-500">Rule of thumb: judge progress using weekly averages, not one weigh-in.</p>
              </div>

              <div class="rounded-lg border border-gray-100 bg-white p-4 shadow-sm">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs uppercase tracking-wide text-gray-400">Macros (daily)</div>
                    <div class="text-lg font-bold text-[var(--secondary-color)]">Protein ‚Ä¢ Carbs ‚Ä¢ Fats</div>
                  </div>
                  <span class="text-xs font-semibold px-2 py-1 rounded-full bg-[var(--primary-color)]/10 text-[var(--primary-color)]">Priority</span>
                </div>
                <div class="mt-4 grid gap-2 sm:grid-cols-3" id="macros">
                  <div class="rounded-lg border border-gray-100 bg-gray-50 p-3">
                    <div class="text-xs uppercase tracking-wide text-gray-500">Protein</div>
                    <div class="mt-1 text-xl font-extrabold text-gray-900" id="macroProtein">‚Äî</div>
                    <div class="text-xs text-gray-500">grams/day</div>
                  </div>
                  <div class="rounded-lg border border-gray-100 bg-gray-50 p-3">
                    <div class="text-xs uppercase tracking-wide text-gray-500">Carbs</div>
                    <div class="mt-1 text-xl font-extrabold text-gray-900" id="macroCarbs">‚Äî</div>
                    <div class="text-xs text-gray-500">grams/day</div>
                  </div>
                  <div class="rounded-lg border border-gray-100 bg-gray-50 p-3">
                    <div class="text-xs uppercase tracking-wide text-gray-500">Fats</div>
                    <div class="mt-1 text-xl font-extrabold text-gray-900" id="macroFats">‚Äî</div>
                    <div class="text-xs text-gray-500">grams/day</div>
                  </div>
                </div>
              </div>
            </div>

            <form id="emailPlanForm" class="mt-6 hidden">
              <div class="rounded-xl border border-gray-100 bg-gray-50 p-4">
                <label for="planEmail" class="block text-sm font-semibold text-gray-800">Get this plan emailed to me</label>
                <div class="mt-2 flex flex-col sm:flex-row gap-2">
                  <input id="planEmail" name="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" class="w-full rounded-md border border-gray-200 px-3 py-2" />
                  <button id="emailPlanSubmit" type="submit" class="bg-[var(--secondary-color)] text-white px-5 py-2.5 rounded-md font-bold hover:shadow">Email my plan</button>
                </div>
                <p id="emailPlanStatus" class="mt-2 text-sm text-gray-600" aria-live="polite"></p>
                <p class="mt-2 text-xs text-gray-500">Optional ‚Äî you can continue without entering an email.</p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section class="bg-white py-16">
      <div class="max-w-6xl mx-auto px-6">
        <h2 class="text-3xl font-extrabold text-center text-[var(--secondary-color)]">Why this tool exists</h2>
        <div class="mt-3 mx-auto max-w-3xl">
          <p class="text-center text-gray-600">This tool was built to solve a common problem: people want to cut fat without guessing, starving, or following generic plans that don‚Äôt fit real life.</p>
          <p class="mt-4 text-center text-gray-600">Instead of selling programs or coaching upfront, DRD Fitness focuses on simple calculators that give you clarity first ‚Äî calories, macros, and realistic expectations ‚Äî before you commit to anything.</p>
        </div>
        <div class="mt-10 grid gap-6 md:grid-cols-3">
          <div class="border border-gray-100 rounded-xl p-6 shadow-sm">
            <h3 class="text-xl font-bold text-[var(--secondary-color)]">What this replaces</h3>
            <p class="mt-2 text-gray-700">Most fat loss advice relies on averages, hype, or one-size-fits-all plans. This calculator replaces guesswork with numbers based on your body, activity level, and goals.</p>
          </div>
          <div class="border border-gray-100 rounded-xl p-6 shadow-sm">
            <h3 class="text-xl font-bold text-[var(--secondary-color)]">Who this is for</h3>
            <p class="mt-2 text-gray-700">Designed for people who train, work, and live normal lives. Whether you lift weights, play sport, or just want structure, this tool gives you a starting point without extremes.</p>
          </div>
          <div class="border border-gray-100 rounded-xl p-6 shadow-sm">
            <h3 class="text-xl font-bold text-[var(--secondary-color)]">What you get</h3>
            <p class="mt-2 text-gray-700">A realistic daily calorie target, protein-first macro guidance, and a clear direction ‚Äî without meal plans, supplements, or pressure to buy anything.</p>
          </div>
        </div>
        <p class="mt-8 text-center text-xs text-gray-600/70">Results depend on consistency, training, and adherence ‚Äî this tool gives you the numbers, not false promises.</p>
      </div>
    </section>

    <section id="pricing" class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <h2 class="text-3xl font-extrabold text-center text-[var(--secondary-color)]">Pricing</h2>
        <p class="mt-3 text-center text-gray-600">Start free, upgrade when you want deeper insights.</p>
        <div class="mt-10 grid gap-6 md:grid-cols-3">
          <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm">
            <h3 class="text-xl font-bold">Starter</h3>
            <p class="mt-1 text-gray-600">For getting the baseline right.</p>
            <div class="mt-4 text-3xl font-extrabold">¬£0</div>
            <ul class="mt-4 space-y-2 text-gray-600">
              <li>Baseline calculator</li>
              <li>Macro targets</li>
              <li>Weekly check-in</li>
            </ul>
            <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=pricing&utm_campaign=cut-controller" class="mt-6 inline-block w-full text-center bg-[var(--primary-color)] text-white px-4 py-3 rounded-md font-bold">Start Free</a>
          </div>
          <div class="bg-white rounded-xl border-2 border-[var(--primary-color)] p-6 shadow-lg">
            <div class="text-xs uppercase tracking-wide text-[var(--primary-color)] font-bold">Most Popular</div>
            <h3 class="mt-2 text-xl font-bold">Pro</h3>
            <p class="mt-1 text-gray-600">Pro includes everything in Free.</p>
            <div class="mt-4 text-3xl font-extrabold">¬£9<span class="text-base font-semibold text-gray-500">/mo</span></div>
            <ul class="mt-4 space-y-2 text-gray-600">
              <li><span class="font-semibold text-gray-800">Example weekly calorie rule:</span> if your 7‚Äëday average is down ~0.3‚Äì0.7 kg, keep calories the same; if not, adjust by ~100 kcal/day.</li>
              <li><span class="font-semibold text-gray-800">Example performance adjustment:</span> if lifts or training quality drop for a full week, hold calories steady and shift more carbs around workouts.</li>
              <li><span class="font-semibold text-gray-800">Example ‚Äútoo fast / too slow‚Äù correction:</span> losing too fast? add ~100‚Äì150 kcal/day. Too slow? reduce ~100 kcal/day or add ~2,000 steps/day.</li>
            </ul>
            <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=pricing-pro&utm_campaign=cut-controller" class="mt-6 inline-block w-full text-center bg-[var(--primary-color)] text-white px-4 py-3 rounded-md font-bold">Upgrade for Pro</a>
          </div>
          <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm">
            <h3 class="text-xl font-bold">Coach</h3>
            <p class="mt-1 text-gray-600">For clients and teams.</p>
            <div class="mt-4 text-3xl font-extrabold">¬£29<span class="text-base font-semibold text-gray-500">/mo</span></div>
            <ul class="mt-4 space-y-2 text-gray-600">
              <li>Multi-client dashboard</li>
              <li>Shared plans</li>
              <li>Exportable reports</li>
            </ul>
            <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=pricing-coach&utm_campaign=cut-controller" class="mt-6 inline-block w-full text-center border-2 border-[var(--secondary-color)] text-[var(--secondary-color)] px-4 py-3 rounded-md font-bold">Talk to us</a>
          </div>
        </div>
      </div>
    </section>

    <section class="bg-[var(--dark-bg)] text-white py-16">
      <div class="max-w-6xl mx-auto px-6 text-center">
        <h2 class="text-3xl font-extrabold">Ready to cut with confidence?</h2>
        <p class="mt-3 text-white/80">Start free today and let the Cut Controller guide your next week.</p>
        <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
          <a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=cta&utm_campaign=cut-controller" class="bg-[var(--primary-color)] text-white px-6 py-3 rounded-md font-bold hover:shadow-lg">Start Free</a>
          <a href="#pricing" class="border-2 border-white text-white px-6 py-3 rounded-md font-bold hover:bg-white hover:text-[var(--secondary-color)]">Upgrade for Pro</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-[var(--dark-bg)] text-white py-8">
    <div class="max-w-6xl mx-auto px-6 flex flex-wrap justify-center gap-6 text-sm">
      <a href="/" class="hover:text-[var(--primary-color)]">Home</a>
      <a href="/workouts" class="hover:text-[var(--primary-color)]">Workouts</a>
      <a href="/supplements" class="hover:text-[var(--primary-color)]">Supplements</a>
      <a href="/blog/fitness-confidence-2026" class="hover:text-[var(--primary-color)]">Blog</a>
      <a href="/gear" class="hover:text-[var(--primary-color)]">Gear</a>
      <a href="/privacy" class="hover:text-[var(--primary-color)]">Privacy Policy</a>
      <a href="/terms" class="hover:text-[var(--primary-color)]">Terms of Service</a>
    </div>
    <p class="mt-4 text-center text-xs text-white/60">¬© 2026 DRD Fitness. All rights reserved.</p>
  </footer>

  <script src="/scripts/cookie-consent.js"></script>
  <script>
    const form = document.getElementById('cutControllerForm');
    const statusEl = document.getElementById('formStatus');
    const resultsCard = document.getElementById('resultsCard');
    const targetCaloriesEl = document.getElementById('targetCalories');
    const macrosEl = document.getElementById('macros');
    const macroProteinEl = document.getElementById('macroProtein');
    const macroCarbsEl = document.getElementById('macroCarbs');
    const macroFatsEl = document.getElementById('macroFats');
    const weeklyLossEl = document.getElementById('weeklyLoss');
    const emailPlanForm = document.getElementById('emailPlanForm');
    const planEmailEl = document.getElementById('planEmail');
    const emailPlanSubmitEl = document.getElementById('emailPlanSubmit');
    const emailPlanStatusEl = document.getElementById('emailPlanStatus');
    const actionPlanCaloriesEl = document.getElementById('actionPlanCalories');
    const actionPlanWeeklyChangeEl = document.getElementById('actionPlanWeeklyChange');
    const actionPlanAdjustEl = document.getElementById('actionPlanAdjust');

    const SIGNUP_ENDPOINT = 'https://api.drdfitness.co.uk/v1/signup/';
    let lastCalculated = null;
    let lastInputs = null;

    function showResults() {
      resultsCard.classList.remove('opacity-0', 'translate-y-2');
      resultsCard.classList.add('opacity-100', 'translate-y-0');

      if (emailPlanForm) {
        emailPlanForm.classList.remove('hidden');
      }
    }

    function setEmailPlanStatus(message, kind) {
      emailPlanStatusEl.textContent = message || '';
      const base = 'mt-2 text-sm';
      const color = kind === 'success'
        ? 'text-emerald-700'
        : kind === 'error'
          ? 'text-rose-700'
          : 'text-gray-600';
      emailPlanStatusEl.className = `${base} ${color}`;
    }

    function isValidEmail(email) {
      return /^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(String(email || '').trim());
    }

    function formatMacros(macros) {
      if (!macros || typeof macros !== 'object') {
        macroProteinEl.textContent = '‚Äî';
        macroCarbsEl.textContent = '‚Äî';
        macroFatsEl.textContent = '‚Äî';
        return;
      }
      macroProteinEl.textContent = `${macros.protein_g ?? '‚Äî'} g`;
      macroCarbsEl.textContent = `${macros.carbs_g ?? '‚Äî'} g`;
      macroFatsEl.textContent = `${macros.fats_g ?? '‚Äî'} g`;
    }

    function kgToLb(kg) {
      return kg * 2.2046226218;
    }

    function round1(n) {
      return Math.round(n * 10) / 10;
    }

    function clampInt(n, min, max) {
      if (!Number.isFinite(n)) return min;
      return Math.min(max, Math.max(min, Math.round(n)));
    }

    function updateActionPlan(calculated, inputs) {
      if (!actionPlanCaloriesEl || !actionPlanWeeklyChangeEl || !actionPlanAdjustEl) return;
      if (!calculated || typeof calculated !== 'object') return;

      const targetKcal = Number(calculated.target_calories_kcal);
      const weeklyLossKg = Number(calculated.weekly_loss_target_kg);
      const hasTarget = Number.isFinite(targetKcal);
      const hasWeeklyLoss = Number.isFinite(weeklyLossKg);

      actionPlanCaloriesEl.textContent = hasTarget
        ? `Daily calorie target: hit ~${Math.round(targetKcal)} kcal/day.`
        : 'Daily calorie target: ‚Äî';

      if (hasWeeklyLoss) {
        const kg = round1(Math.abs(weeklyLossKg));
        const lb = round1(Math.abs(kgToLb(weeklyLossKg)));
        actionPlanWeeklyChangeEl.textContent = `Expected weekly weight change: ~${kg} kg (${lb} lb) per week.`;
      } else {
        actionPlanWeeklyChangeEl.textContent = 'Expected weekly weight change: ‚Äî';
      }

      const sex = (inputs && inputs.sex) ? String(inputs.sex).toLowerCase() : '';
      const minKcal = sex === 'female' ? 1200 : 1500;
      const currentSteps = inputs && Number.isFinite(Number(inputs.steps_per_day)) ? Number(inputs.steps_per_day) : null;
      const suggestedSteps = currentSteps != null ? clampInt(currentSteps + 2000, 0, 40000) : null;
      const suggestedKcal = hasTarget ? clampInt(targetKcal - 100, minKcal, 5000) : null;

      const adjustText = (() => {
        const stepPart = suggestedSteps != null
          ? `or add +2,000 steps/day (to ~${suggestedSteps}).`
          : 'or add +2,000 steps/day.';
        const kcalPart = suggestedKcal != null
          ? `drop ${Math.round(targetKcal)} ‚Üí ${suggestedKcal} kcal/day (then reassess).`
          : 'reduce calories by ~100 kcal/day (then reassess).';

        return `If your weekly average hasn‚Äôt moved for 2 weeks, ${kcalPart} ${stepPart}`;
      })();

      actionPlanAdjustEl.textContent = adjustText;
    }

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      statusEl.textContent = 'Calculating...';

      if (typeof window.hasConsent === 'function' && !window.hasConsent('functional')) {
        statusEl.textContent = 'Please enable Functional cookies to use the Cut Controller.';
        if (typeof window.openCookieBanner === 'function') {
          window.openCookieBanner();
        }
        return;
      }

      const payload = {
        sex: document.getElementById('sex').value,
        age: Number(document.getElementById('age').value),
        height: Number(document.getElementById('height').value),
        weight: Number(document.getElementById('weight').value),
        activity_level: document.getElementById('activityLevel').value,
        training_days_per_week: Number(document.getElementById('trainingDays').value),
        steps_per_day: Number(document.getElementById('steps').value)
      };

      try {
        const response = await fetch('https://api.drdfitness.co.uk/v1/cut-controller/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error('Unable to calculate targets. Please try again.');
        }

        const data = await response.json();
        lastCalculated = data;
        lastInputs = payload;
        targetCaloriesEl.textContent = `${data.target_calories_kcal ?? '‚Äî'} kcal`;
        weeklyLossEl.textContent = `${data.weekly_loss_target_kg ?? '‚Äî'} kg / week`;
        formatMacros(data.macros);
        updateActionPlan(data, payload);
        showResults();
        statusEl.textContent = 'Targets updated.';
        setEmailPlanStatus('', '');
      } catch (error) {
        statusEl.textContent = error.message;
      }
    });

    if (emailPlanForm) {
      emailPlanForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const email = String(planEmailEl.value || '').trim();

        if (!email) {
          setEmailPlanStatus('No pressure ‚Äî add an email only if you want the plan sent to you.', '');
          return;
        }

        if (!isValidEmail(email)) {
          setEmailPlanStatus('Please enter a valid email address.', 'error');
          return;
        }

        if (!lastCalculated) {
          setEmailPlanStatus('Calculate your plan first, then email it.', 'error');
          return;
        }

        emailPlanSubmitEl.disabled = true;
        emailPlanSubmitEl.classList.add('opacity-70');
        setEmailPlanStatus('Sending...', '');

        try {
          const resp = await fetch(SIGNUP_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email,
              source: 'cut-controller',
              createdAt: new Date().toISOString(),
              inputs: lastInputs,
              results: lastCalculated
            })
          });

          if (!resp.ok) {
            throw new Error('Could not send email right now. Please try again.');
          }

          setEmailPlanStatus('Success ‚Äî check your inbox in a moment.', 'success');
        } catch (err) {
          setEmailPlanStatus(err.message || 'Could not send email right now. Please try again.', 'error');
        } finally {
          emailPlanSubmitEl.disabled = false;
          emailPlanSubmitEl.classList.remove('opacity-70');
        }
      });
    }

    form.addEventListener('reset', () => {
      statusEl.textContent = '';
      targetCaloriesEl.textContent = '‚Äî';
      weeklyLossEl.textContent = '‚Äî';
      formatMacros(null);
      if (actionPlanCaloriesEl) actionPlanCaloriesEl.textContent = 'Daily calorie target: ‚Äî';
      if (actionPlanWeeklyChangeEl) actionPlanWeeklyChangeEl.textContent = 'Expected weekly weight change: ‚Äî';
      if (actionPlanAdjustEl) actionPlanAdjustEl.textContent = 'If progress stalls: ‚Äî';
      lastCalculated = null;
      lastInputs = null;
      if (planEmailEl) planEmailEl.value = '';
      if (emailPlanForm) emailPlanForm.classList.add('hidden');
      if (emailPlanStatusEl) setEmailPlanStatus('', '');
      resultsCard.classList.add('opacity-0', 'translate-y-2');
      resultsCard.classList.remove('opacity-100', 'translate-y-0');
    });
  </script>
</body>
</html>
