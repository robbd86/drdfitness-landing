<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="impact-site-verification" content="8f866883-939f-4946-9bbf-7d47385f190c" />

  <title>Workout Builder (Free) | DRD Fitness</title>
  <meta name="description" content="Build a simple weekly workout plan based on your days, goal, and experience. Free signup to save your plan." />
  <link rel="canonical" href="https://drdfitness.co.uk/workouts/workout-builder" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Workout Builder (Free)" />
  <meta property="og:description" content="Build a simple weekly workout plan based on your days, goal, and experience. Free signup to save your plan." />
  <meta property="og:url" content="https://drdfitness.co.uk/workouts/workout-builder" />

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí™</text></svg>" />

  <style>
    :root {
      --primary-color: #FF6B35;
      --secondary-color: #004E89;
      --accent-color: #1A659E;
      --dark-bg: #1A1A1D;
      --light-bg: #F5F5F5;
      --text-dark: #2C2C2C;
      --text-light: #FFFFFF;

      --color-primary: var(--primary-color);
      --color-primary-rgb: 255, 107, 53;
      --color-bg-main: var(--light-bg);
      --color-bg-alt: #FFFFFF;
      --color-bg-card: #FFFFFF;
      --color-text-primary: var(--text-dark);
      --color-text-secondary: #3f3f3f;
      --color-text-muted: #6b6b6b;
      --color-border: #e3e3e3;
      --color-button-text: var(--text-light);
      --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--light-bg);
      color: var(--text-dark);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    nav {
      background-color: var(--dark-bg);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      color: var(--text-light);
      text-decoration: none;
      transition: color 0.3s;
      font-weight: 500;
    }

    .nav-links a:hover {
      color: var(--primary-color);
    }

    .menu-toggle {
      display: none;
      flex-direction: column;
      cursor: pointer;
    }

    .menu-toggle span {
      width: 25px;
      height: 3px;
      background-color: var(--text-light);
      margin: 3px 0;
      transition: 0.3s;
    }

    /* IMPORTANT: Do not modify links/URLs during layout/styling changes. */
    .site-banner {
      width: 100%;
      max-width: none;
      margin: 0;
      background: var(--color-bg-alt);
      border-bottom: 1px solid var(--color-border);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      line-height: 0;
      display: flex;
      align-items: center;
      padding: 8px 0;
      z-index: 2;
    }

    .site-banner img {
      width: 100%;
      height: auto;
      max-height: 320px;
      display: block;
    }

    @media (max-width: 768px) {
      .site-banner { padding: 6px 0; }
      .site-banner img { max-height: 220px; }
    }

    .top-nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      padding: 22px 20px 0;
    }

    .top-nav .btn,
    .top-nav .cta-btn {
      min-width: 160px;
      text-align: center;
    }

    .btn,
    .cta-btn {
      display: inline-block;
      background-color: var(--primary-color);
      color: var(--text-light);
      padding: 0.75rem 1.5rem;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .btn:hover,
    .cta-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    }

    .btn:active,
    .cta-btn:active {
      transform: translateY(0);
    }

    .btn:focus-visible,
    .cta-btn:focus-visible {
      outline: none;
      box-shadow:
        0 4px 12px rgba(255, 107, 53, 0.3),
        0 0 0 3px rgba(255, 107, 53, 0.25);
    }

    .btn-disabled {
      opacity: 0.8;
      cursor: default;
    }

    .btn-disabled:hover,
    .btn-disabled:active {
      transform: none;
      box-shadow: none;
      filter: none;
    }

    .btn-ghost {
      display: inline-block;
      background: transparent;
      color: var(--secondary-color);
      padding: 0.75rem 1.5rem;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      border: 2px solid var(--secondary-color);
      cursor: pointer;
      font-size: 0.98rem;
      transition: transform 0.18s ease, background 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
      line-height: 1;
    }

    .btn-ghost:hover {
      transform: translateY(-1px);
      background: var(--secondary-color);
      color: var(--text-light);
      border-color: var(--secondary-color);
    }

    .btn-ghost:active { transform: translateY(0); }

    .btn-ghost:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.25);
      border-color: var(--primary-color);
    }

    main { padding: 44px 20px 64px; }

    .container-narrow {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 14px;
      font-size: clamp(2.2rem, 5vw, 3.1rem);
      font-weight: 800;
      line-height: 1.12;
      letter-spacing: -0.02em;
    }

    .subtitle {
      margin: 0 0 22px;
      color: var(--color-text-muted);
      font-size: 1.05rem;
      line-height: 1.6;
      max-width: 780px;
    }

    .divider {
      width: 86px;
      height: 1px;
      background: var(--primary-color);
      margin: 14px 0 26px;
      opacity: 0.9;
    }

    input,
    select {
      width: 100%;
      background: #ffffff;
      color: var(--text-dark);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 1rem;
      outline: none;
    }

    input:focus,
    select:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.18);
    }

    .field { margin-bottom: 14px; }

    .hint {
      margin-top: 6px;
      color: var(--color-text-muted);
      font-size: 0.9rem;
      line-height: 1.45;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
      align-items: center;
    }

    .row input {
      flex: 1;
      min-width: 240px;
    }

    .status {
      margin-top: 10px;
      min-height: 1.2em;
      color: var(--color-text-muted);
      font-size: 0.92rem;
      line-height: 1.5;
    }

    .status strong { color: var(--color-primary); }

    .plan {
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(var(--color-primary-rgb), 0.14);
      position: relative;
    }

    .plan-watermark {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0.08;
      font-weight: 900;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-size: clamp(2.2rem, 5vw, 4.2rem);
      color: var(--color-text-primary);
      transform: rotate(-12deg);
      user-select: none;
    }

    .plan-watermark[data-visible="true"] {
      display: flex;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: #f4f6f8;
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
      font-size: 0.9rem;
      line-height: 1;
      margin-top: 10px;
    }

    .pill strong { color: var(--color-primary); }

    details {
      background: #ffffff;
      border: 1px solid var(--color-border);
      border-radius: 12px;
      padding: 12px 12px;
      margin-top: 12px;
    }

    details summary {
      cursor: pointer;
      font-weight: 750;
      color: var(--color-text-secondary);
      list-style: none;
    }

    details summary::-webkit-details-marker { display: none; }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      border: 1px solid var(--color-border);
      border-radius: 12px;
      overflow: hidden;
      background: #ffffff;
    }

    .table th,
    .table td {
      padding: 12px 12px;
      border-bottom: 1px solid var(--color-border);
      vertical-align: top;
      text-align: left;
    }

    .table th {
      font-size: 0.85rem;
      color: var(--color-text-muted);
      font-weight: 750;
      background: #f4f6f8;
    }

    .table tr:last-child td { border-bottom: none; }

    .exercise-select {
      width: 100%;
      min-width: 180px;
      margin-top: 6px;
    }

    .muted {
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }

    .plan h3 {
      margin: 0 0 10px;
      font-size: 1.05rem;
      color: var(--color-primary);
      font-weight: 750;
    }

    .day {
      margin-top: 12px;
      padding: 14px;
      background: #ffffff;
      border: 1px solid var(--color-border);
      border-radius: 12px;
    }

    .day-title {
      font-weight: 800;
      letter-spacing: -0.01em;
      margin-bottom: 8px;
    }

    ul {
      margin: 8px 0 0;
      padding-left: 18px;
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    .micro {
      margin-top: 10px;
      color: var(--color-text-muted);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    @media (max-width: 860px) {
      .grid { grid-template-columns: 1fr; }
    }

    footer {
      background: var(--color-bg-alt);
      border-top: 1px solid var(--color-border);
      padding: 44px 20px;
      text-align: center;
      color: var(--color-text-muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    footer a {
      color: var(--color-text-secondary);
      text-decoration: none;
      border-bottom: 1px solid transparent;
    }

    footer a:hover {
      color: var(--color-primary);
      border-bottom-color: var(--color-primary);
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-container">
      <a href="/" class="logo">DRD FITNESS</a>
      <div class="menu-toggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <ul class="nav-links" id="navLinks">
        <li><a href="/workouts">Workouts</a></li>
        <li><a href="/workouts/workout-builder">Workout Builder</a></li>
        <li><a href="/supplements">Supplements</a></li>
        <li><a href="/blog/fitness-confidence-2026">Blog</a></li>
        <li><a href="/gear">My Gear</a></li>
        <li><a href="https://app.drdfitness.co.uk/?utm_source=drdfitness.co.uk&utm_medium=nav&utm_campaign=launch" class="btn">Open App</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <div class="container-narrow">
      <h1>Workout Builder</h1>
      <p class="subtitle">Build a simple weekly plan based on your schedule, goal, and experience. It‚Äôs designed to be clear and doable ‚Äî not perfect on paper.</p>
      <p class="subtitle">Cutting right now? Pair your plan with <a href="/cut-controller/">weekly fat loss targets</a> so you know what to adjust.</p>
      <div class="divider" aria-hidden="true"></div>

      <div id="gate" class="grid">
        <section class="card" aria-label="Workout Builder signup gate">
          <h2>Create a free account to continue</h2>
          <p class="hint">This keeps things simple: you can save your workout plan, come back later, and get a plan that fits your goal and experience.</p>
          <p class="hint">It‚Äôs free. No spam. You can unsubscribe anytime.</p>

          <div class="field">
            <label for="signupName">First name (optional)</label>
            <input id="signupName" name="signupName" type="text" autocomplete="given-name" placeholder="e.g. Sam" />
          </div>

          <div class="field">
            <label for="signupEmail">Email</label>
            <input id="signupEmail" name="signupEmail" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" />
            <div class="hint">We use this to link saved plans to you (on this device).</div>
          </div>

          <div class="row">
            <button class="btn" id="signupBtn" type="button">Create free account</button>
            <button class="btn-ghost" id="guestBtn" type="button">Continue without saving</button>
          </div>

          <div class="status" id="gateStatus" aria-live="polite"></div>
          <div class="micro">Already signed up on this device? Just enter your email and press ‚ÄúCreate free account‚Äù.</div>
          <div class="micro"><strong>Guest mode:</strong> you can generate a plan, but it won‚Äôt be saved (you‚Äôll see an ‚ÄúUNSAVED‚Äù watermark).</div>
        </section>

        <section class="card" aria-label="What you get">
          <h2>What you‚Äôll get</h2>
          <ul>
            <li>A simple weekly plan you can actually follow</li>
            <li>Clear exercise choices + sets and reps</li>
            <li>A way to save and revisit your plan</li>
          </ul>
          <p class="micro"><strong>Note:</strong> This is an MVP. It‚Äôs meant to remove decision fatigue ‚Äî not replace coaching.</p>
        </section>
      </div>

      <div id="builder" class="grid" hidden>
        <section class="card" aria-label="Workout Builder inputs">
          <h2>Your plan settings</h2>
          <div class="hint">Pick something you can stick to. The best plan is the one you repeat for a few weeks.</div>

          <div class="field">
            <label for="days">Days per week</label>
            <select id="days" name="days">
              <option value="2">2 days</option>
              <option value="3" selected>3 days</option>
              <option value="4">4 days</option>
              <option value="5">5 days</option>
            </select>
          </div>

          <div class="field">
            <label for="goal">Goal</label>
            <select id="goal" name="goal">
              <option value="lose">Lose fat</option>
              <option value="maintain" selected>Maintain</option>
              <option value="gain">Build muscle</option>
            </select>
            <div class="hint">The plan structure stays simple ‚Äî the main difference is how hard you push and how you progress.</div>
          </div>

          <div class="field">
            <label for="experience">Experience level</label>
            <select id="experience" name="experience">
              <option value="beginner" selected>Beginner</option>
              <option value="intermediate">Intermediate</option>
            </select>
          </div>

          <details id="advanced">
            <summary>Advanced options (optional)</summary>

            <div class="field" style="margin-top: 12px;">
              <label for="sessionLength">Session length</label>
              <select id="sessionLength" name="sessionLength">
                <option value="45">~45 minutes</option>
                <option value="60" selected>~60 minutes</option>
                <option value="75">~75 minutes</option>
              </select>
              <div class="hint">Shorter sessions prioritize the main lifts. Longer sessions add a little extra work.</div>
            </div>

            <div class="field">
              <label for="equipment">Equipment preference</label>
              <select id="equipment" name="equipment">
                <option value="mixed" selected>Mixed</option>
                <option value="machines">Machines</option>
                <option value="dumbbells">Dumbbells</option>
                <option value="barbell">Barbell</option>
              </select>
            </div>

            <div class="field">
              <label for="priority">Training priority</label>
              <select id="priority" name="priority">
                <option value="hypertrophy" selected>Hypertrophy (muscle)</option>
                <option value="strength">Strength (performance)</option>
              </select>
            </div>

            <div class="field">
              <label for="weakPoint">Weak point focus (optional)</label>
              <select id="weakPoint" name="weakPoint">
                <option value="none" selected>None</option>
                <option value="back">Back</option>
                <option value="shoulders">Shoulders</option>
                <option value="glutes">Glutes</option>
                <option value="arms">Arms</option>
                <option value="core">Core</option>
              </select>
              <div class="hint">This only nudges accessory choices. Keep the plan repeatable.</div>
            </div>
          </details>

          <div class="row">
            <button class="btn" id="generate" type="button">Generate plan</button>
            <button class="btn-ghost" id="save" type="button">Save plan</button>
            <button class="btn-ghost" id="print" type="button">Print plan</button>
            <button class="btn-ghost" id="logout" type="button">Log out</button>
          </div>

          <div class="status" id="builderStatus" aria-live="polite"></div>
          <div class="micro">Tip: Keep the same plan for 4‚Äì6 weeks. Small progress each week adds up.</div>
        </section>

        <section class="card" aria-label="Workout Builder output">
          <h2>Your weekly plan</h2>
          <div class="hint">This is a simple template. Choose exercises you can perform with good form and control.</div>

          <div class="plan" id="plan" hidden>
            <div class="plan-watermark" id="planWatermark" aria-hidden="true">UNSAVED</div>
            <h3 id="planTitle">Plan</h3>
            <div class="pill" id="planMeta" hidden></div>
            <div id="planDays"></div>
            <div class="micro"><strong>Progress rule:</strong> when you hit the top of the rep range for all sets, add a small amount of weight next time.</div>
          </div>

          <div class="status" id="planEmpty">Generate a plan to see your week.</div>
        </section>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="/workouts">Workouts</a>
      <a href="/supplements">Supplements</a>
      <a href="/blog/fitness-confidence-2026">Blog</a>
      <a href="/gear">Gear</a>
      <a href="/privacy">Privacy Policy</a>
      <a href="/terms">Terms of Service</a>
    </div>
    <p>&copy; 2025 DRD Fitness. All rights reserved.</p>
  </footer>

  <script>
    function toggleMenu() {
      const navLinks = document.getElementById('navLinks');
      navLinks.classList.toggle('active');
    }

    document.addEventListener('click', function(event) {
      const navLinks = document.getElementById('navLinks');
      if (!event.target.closest('.nav-container')) {
        navLinks.classList.remove('active');
      }
    });

    const STORAGE_USER_KEY = 'drd_workout_builder_user';
    const STORAGE_PLAN_KEY_PREFIX = 'drd_workout_builder_plan:';
    const STORAGE_GUEST_KEY = 'drd_workout_builder_guest';

    const gateEl = document.getElementById('gate');
    const builderEl = document.getElementById('builder');

    const signupNameEl = document.getElementById('signupName');
    const signupEmailEl = document.getElementById('signupEmail');
    const signupBtnEl = document.getElementById('signupBtn');
    const guestBtnEl = document.getElementById('guestBtn');
    const gateStatusEl = document.getElementById('gateStatus');

    const daysEl = document.getElementById('days');
    const goalEl = document.getElementById('goal');
    const experienceEl = document.getElementById('experience');
    const generateEl = document.getElementById('generate');
    const saveEl = document.getElementById('save');
    const printEl = document.getElementById('print');
    const logoutEl = document.getElementById('logout');
    const builderStatusEl = document.getElementById('builderStatus');

    const planEl = document.getElementById('plan');
    const planTitleEl = document.getElementById('planTitle');
    const planMetaEl = document.getElementById('planMeta');
    const planDaysEl = document.getElementById('planDays');
    const planEmptyEl = document.getElementById('planEmpty');
    const planWatermarkEl = document.getElementById('planWatermark');

    const sessionLengthEl = document.getElementById('sessionLength');
    const equipmentEl = document.getElementById('equipment');
    const priorityEl = document.getElementById('priority');
    const weakPointEl = document.getElementById('weakPoint');

    function safeJsonParse(value) {
      try { return JSON.parse(value); } catch { return null; }
    }

    function getUser() {
      const raw = localStorage.getItem(STORAGE_USER_KEY);
      if (!raw) return null;
      const user = safeJsonParse(raw);
      if (!user || !user.email) return null;
      return user;
    }

    function isGuest() {
      return localStorage.getItem(STORAGE_GUEST_KEY) === '1';
    }

    function setGuest(enabled) {
      if (enabled) localStorage.setItem(STORAGE_GUEST_KEY, '1');
      else localStorage.removeItem(STORAGE_GUEST_KEY);
    }

    function setUser(user) {
      localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(user));
    }

    function clearUser() {
      localStorage.removeItem(STORAGE_USER_KEY);
    }

    function getPlanKey(email) {
      return STORAGE_PLAN_KEY_PREFIX + String(email).toLowerCase();
    }

    function setSavedPlan(email, plan) {
      localStorage.setItem(getPlanKey(email), JSON.stringify(plan));
    }

    function getSavedPlan(email) {
      const raw = localStorage.getItem(getPlanKey(email));
      if (!raw) return null;
      return safeJsonParse(raw);
    }

    function isValidEmail(email) {
      // Lightweight check; keep it friendly.
      return /\S+@\S+\.\S+/.test(email);
    }

    function showGate() {
      gateEl.hidden = false;
      builderEl.hidden = true;
    }

    function showBuilder() {
      gateEl.hidden = true;
      builderEl.hidden = false;
    }

    function clearPlanUI() {
      planEl.hidden = true;
      planDaysEl.innerHTML = '';
      planEmptyEl.textContent = 'Generate a plan to see your week.';
      planMetaEl.hidden = true;
      planMetaEl.textContent = '';
      planWatermarkEl.dataset.visible = 'false';
    }

    function getExerciseLibrary() {
      // Preset-only swaps for now. Keep structure open for future custom entries.
      return {
        squat: {
          barbell: ['Back squat', 'Front squat', 'High-bar squat'],
          dumbbells: ['Goblet squat', 'Dumbbell front squat'],
          machines: ['Leg press', 'Hack squat', 'Smith machine squat'],
          mixed: ['Back squat', 'Leg press', 'Goblet squat', 'Hack squat']
        },
        hinge: {
          barbell: ['Romanian deadlift', 'Deadlift (technique focus)', 'Good morning (light)'],
          dumbbells: ['Dumbbell Romanian deadlift', 'Dumbbell hip hinge'],
          machines: ['Hip thrust machine', 'Cable pull-through', 'Back extension'],
          mixed: ['Romanian deadlift', 'Dumbbell Romanian deadlift', 'Back extension', 'Hip thrust']
        },
        horizontal_push: {
          barbell: ['Bench press', 'Incline bench press'],
          dumbbells: ['Dumbbell bench press', 'Incline dumbbell press'],
          machines: ['Chest press machine', 'Smith machine bench'],
          mixed: ['Bench press', 'Dumbbell bench press', 'Incline dumbbell press', 'Chest press machine']
        },
        horizontal_pull: {
          barbell: ['Barbell row', 'Pendlay row (light)'],
          dumbbells: ['One-arm dumbbell row', 'Chest-supported dumbbell row'],
          machines: ['Seated cable row', 'Chest-supported row machine'],
          mixed: ['Seated cable row', 'One-arm dumbbell row', 'Chest-supported row', 'Barbell row']
        },
        vertical_push: {
          barbell: ['Overhead press', 'Push press (controlled)'],
          dumbbells: ['Dumbbell shoulder press', 'Seated dumbbell press'],
          machines: ['Shoulder press machine', 'Smith machine overhead press'],
          mixed: ['Dumbbell shoulder press', 'Overhead press', 'Shoulder press machine']
        },
        vertical_pull: {
          barbell: ['Pull-up (assisted if needed)', 'Chin-up (assisted if needed)'],
          dumbbells: ['Single-arm lat pull-over (bench)', 'Dumbbell row (elbow path up)'],
          machines: ['Lat pulldown', 'Assisted pull-up'],
          mixed: ['Lat pulldown', 'Assisted pull-up', 'Pull-up', 'Chin-up']
        },
        single_leg: {
          barbell: ['Split squat (barbell)', 'Reverse lunge (barbell)'],
          dumbbells: ['Bulgarian split squat', 'Dumbbell walking lunge'],
          machines: ['Leg extension', 'Leg curl', 'Hack split stance (if available)'],
          mixed: ['Bulgarian split squat', 'Reverse lunge', 'Leg extension']
        },
        posterior_chain: {
          barbell: ['Hip thrust', 'Romanian deadlift (light)'],
          dumbbells: ['Dumbbell hip thrust', 'Dumbbell Romanian deadlift (light)'],
          machines: ['Leg curl', 'Back extension', 'Glute bridge machine'],
          mixed: ['Leg curl', 'Back extension', 'Hip thrust']
        },
        core: {
          barbell: ['Plank', 'Dead bug'],
          dumbbells: ['Side plank', 'Dead bug'],
          machines: ['Cable crunch', 'Pallof press'],
          mixed: ['Plank', 'Cable crunch', 'Pallof press', 'Side plank']
        },
        arms: {
          barbell: ['EZ-bar curl', 'Close-grip bench press'],
          dumbbells: ['Dumbbell curl', 'Overhead triceps extension'],
          machines: ['Cable curl', 'Triceps pushdown'],
          mixed: ['Cable curl', 'Triceps pushdown', 'Dumbbell curl']
        },
        conditioning: {
          barbell: ['Incline treadmill walk', 'Bike (easy)'],
          dumbbells: ['Incline treadmill walk', 'Bike (easy)'],
          machines: ['Incline treadmill walk', 'Bike (easy)', 'Row (easy)'],
          mixed: ['Incline treadmill walk', 'Bike (easy)']
        }
      };
    }

    function pickOptionsForPattern(library, pattern, equipment) {
      const group = library[pattern];
      if (!group) return ['Choose an exercise'];
      return group[equipment] || group.mixed || ['Choose an exercise'];
    }

    function buildRow({ patternKey, patternLabel, sets, reps, rest, note }, context) {
      const library = context.library;
      const options = pickOptionsForPattern(library, patternKey, context.equipment);
      const exercise = options[0];
      return {
        id: `${patternKey}:${Math.random().toString(16).slice(2)}`,
        patternKey,
        patternLabel,
        exercise,
        options,
        sets,
        reps,
        rest,
        note
      };
    }

    function renderPlan(plan) {
      if (!plan || !plan.days || !Array.isArray(plan.days) || plan.days.length === 0) {
        clearPlanUI();
        return;
      }

      planTitleEl.textContent = plan.title || 'Your weekly plan';

      // Meta badge
      const metaBits = [];
      if (plan.meta?.mode) metaBits.push(plan.meta.mode);
      if (plan.meta?.equipmentLabel) metaBits.push(plan.meta.equipmentLabel);
      if (plan.meta?.sessionLabel) metaBits.push(plan.meta.sessionLabel);
      if (metaBits.length) {
        planMetaEl.innerHTML = `<strong>Plan:</strong> ${metaBits.join(' ‚Ä¢ ')}`;
        planMetaEl.hidden = false;
      } else {
        planMetaEl.hidden = true;
        planMetaEl.textContent = '';
      }

      planWatermarkEl.dataset.visible = plan.meta?.guest ? 'true' : 'false';

      planDaysEl.innerHTML = '';
      for (const day of plan.days) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day';

        const titleEl = document.createElement('div');
        titleEl.className = 'day-title';
        titleEl.textContent = day.name;
        dayEl.appendChild(titleEl);

        const table = document.createElement('table');
        table.className = 'table';
        table.innerHTML = `
          <thead>
            <tr>
              <th style="width: 40%;">Exercise</th>
              <th style="width: 14%;">Sets</th>
              <th style="width: 16%;">Reps</th>
              <th style="width: 16%;">Rest</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector('tbody');

        for (const row of day.rows) {
          const tr = document.createElement('tr');

          const exerciseCell = document.createElement('td');
          const label = document.createElement('div');
          label.style.fontWeight = '800';
          label.style.letterSpacing = '-0.01em';
          label.textContent = row.patternLabel;

          const current = document.createElement('div');
          current.className = 'muted';
          current.textContent = row.exercise;

          const select = document.createElement('select');
          select.className = 'exercise-select';
          select.setAttribute('aria-label', `Swap exercise for ${row.patternLabel}`);
          for (const opt of row.options) {
            const optionEl = document.createElement('option');
            optionEl.value = opt;
            optionEl.textContent = opt;
            select.appendChild(optionEl);
          }
          select.value = row.exercise;
          select.addEventListener('change', () => {
            current.textContent = select.value;
          });

          exerciseCell.appendChild(label);
          exerciseCell.appendChild(current);
          exerciseCell.appendChild(select);

          const setsCell = document.createElement('td');
          setsCell.textContent = row.sets;

          const repsCell = document.createElement('td');
          repsCell.textContent = row.reps;

          const restCell = document.createElement('td');
          restCell.textContent = row.rest;

          const noteCell = document.createElement('td');
          noteCell.textContent = row.note || '';

          tr.appendChild(exerciseCell);
          tr.appendChild(setsCell);
          tr.appendChild(repsCell);
          tr.appendChild(restCell);
          tr.appendChild(noteCell);

          tbody.appendChild(tr);
        }

        dayEl.appendChild(table);

        if (day.note) {
          const note = document.createElement('div');
          note.className = 'micro';
          note.textContent = day.note;
          dayEl.appendChild(note);
        }

        planDaysEl.appendChild(dayEl);
      }

      planEmptyEl.textContent = '';
      planEl.hidden = false;
    }

    function computePrescription({ goal, priority }) {
      const strength = priority === 'strength';

      // Keep rep ranges simple and gym-friendly.
      if (strength) {
        return {
          mainSets: goal === 'gain' ? '4' : '3‚Äì4',
          mainReps: '4‚Äì8',
          mainRest: '2‚Äì3 min',
          accessorySets: '2‚Äì3',
          accessoryReps: '8‚Äì12',
          accessoryRest: '60‚Äì90 sec'
        };
      }

      return {
        mainSets: goal === 'gain' ? '3‚Äì4' : '3',
        mainReps: goal === 'gain' ? '6‚Äì10' : '8‚Äì12',
        mainRest: '90‚Äì150 sec',
        accessorySets: '2‚Äì3',
        accessoryReps: '10‚Äì15',
        accessoryRest: '60‚Äì90 sec'
      };
    }

    function generateBeginnerFullBody(daysCount, context) {
      const p = computePrescription(context);
      const library = context.library;

      const A = {
        name: 'Day A (Full Body)',
        rows: [
          buildRow({ patternKey: 'squat', patternLabel: 'Squat pattern', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_push', patternLabel: 'Horizontal push', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_pull', patternLabel: 'Horizontal pull', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'hinge', patternLabel: 'Hip hinge', sets: p.accessorySets, reps: p.mainReps, rest: p.accessoryRest }, context),
          buildRow({ patternKey: 'core', patternLabel: 'Core', sets: '2', reps: '30‚Äì60 sec', rest: '45‚Äì60 sec' }, context)
        ],
        note: 'Leave 1‚Äì3 reps in the tank. Clean reps first.'
      };

      const B = {
        name: 'Day B (Full Body)',
        rows: [
          buildRow({ patternKey: 'hinge', patternLabel: 'Hinge pattern', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'vertical_push', patternLabel: 'Vertical push', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'vertical_pull', patternLabel: 'Vertical pull', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'single_leg', patternLabel: 'Single-leg', sets: p.accessorySets, reps: `${p.accessoryReps} (each side)`, rest: p.accessoryRest }, context),
          buildRow({ patternKey: 'core', patternLabel: 'Core', sets: '2', reps: '8‚Äì12 (each side)', rest: '45‚Äì60 sec' }, context)
        ],
        note: 'Keep the same exercises for 4‚Äì6 weeks before changing.'
      };

      const C = {
        name: 'Day C (Full Body)',
        rows: [
          buildRow({ patternKey: 'squat', patternLabel: 'Squat pattern (variation)', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_push', patternLabel: 'Horizontal push (variation)', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_pull', patternLabel: 'Horizontal pull (variation)', sets: p.mainSets, reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'posterior_chain', patternLabel: 'Posterior chain', sets: p.accessorySets, reps: p.accessoryReps, rest: p.accessoryRest }, context),
          context.goal === 'lose'
            ? buildRow({ patternKey: 'conditioning', patternLabel: 'Optional conditioning', sets: '1', reps: '10‚Äì20 min (easy)', rest: '‚Äî' }, context)
            : buildRow({ patternKey: 'arms', patternLabel: 'Optional arms', sets: '2', reps: p.accessoryReps, rest: p.accessoryRest }, context)
        ],
        note: 'Small progress each week adds up.'
      };

      let days;
      if (daysCount === 2) days = [A, B];
      else if (daysCount === 3) days = [A, B, C];
      else if (daysCount === 4) days = [A, B, C, A];
      else days = [A, B, C, A, B];

      // If session is short, trim optional last movement.
      if (Number(context.sessionLength) <= 45) {
        for (const d of days) {
          d.rows = d.rows.filter((r, idx) => idx < 4);
        }
      }

      return days;
    }

    function generateIntermediateSplit(daysCount, context) {
      const p = computePrescription(context);

      const Upper = {
        name: 'Upper',
        rows: [
          buildRow({ patternKey: 'horizontal_push', patternLabel: 'Horizontal push', sets: '3‚Äì4', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_pull', patternLabel: 'Horizontal pull', sets: '3‚Äì4', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'vertical_push', patternLabel: 'Vertical push', sets: '2‚Äì3', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'vertical_pull', patternLabel: 'Vertical pull', sets: '2‚Äì3', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'arms', patternLabel: 'Optional arms', sets: p.accessorySets, reps: p.accessoryReps, rest: p.accessoryRest }, context)
        ],
        note: 'Pick variations you can progress safely.'
      };

      const Lower = {
        name: 'Lower',
        rows: [
          buildRow({ patternKey: 'squat', patternLabel: 'Squat pattern', sets: '3‚Äì4', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'hinge', patternLabel: 'Hinge pattern', sets: '3‚Äì4', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'single_leg', patternLabel: 'Single-leg', sets: p.accessorySets, reps: p.mainReps, rest: p.accessoryRest }, context),
          buildRow({ patternKey: 'posterior_chain', patternLabel: 'Posterior chain', sets: p.accessorySets, reps: p.accessoryReps, rest: p.accessoryRest }, context),
          buildRow({ patternKey: 'core', patternLabel: 'Optional core', sets: '2', reps: '8‚Äì12', rest: '45‚Äì60 sec' }, context)
        ],
        note: 'Avoid grinding reps. Stop with 1‚Äì2 reps left.'
      };

      const Full = {
        name: 'Full Body',
        rows: [
          buildRow({ patternKey: 'squat', patternLabel: 'Squat or hinge', sets: '3', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_push', patternLabel: 'Push', sets: '3', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: 'horizontal_pull', patternLabel: 'Pull', sets: '3', reps: p.mainReps, rest: p.mainRest }, context),
          buildRow({ patternKey: context.weakPoint === 'arms' ? 'arms' : (context.weakPoint === 'core' ? 'core' : 'posterior_chain'), patternLabel: 'Accessory (weak point)', sets: '2', reps: p.accessoryReps, rest: p.accessoryRest }, context),
          context.goal === 'lose'
            ? buildRow({ patternKey: 'conditioning', patternLabel: 'Optional conditioning', sets: '1', reps: '10‚Äì20 min (easy)', rest: '‚Äî' }, context)
            : buildRow({ patternKey: 'core', patternLabel: 'Optional core', sets: '2', reps: '8‚Äì12', rest: '45‚Äì60 sec' }, context)
        ],
        note: 'Keep it simple: quality work, repeatable week to week.'
      };

      let days;
      if (daysCount === 2) days = [Full, Full];
      else if (daysCount === 3) days = [Upper, Lower, Full];
      else if (daysCount === 4) days = [Upper, Lower, Upper, Lower];
      else days = [Upper, Lower, Upper, Lower, Full];

      if (Number(context.sessionLength) <= 45) {
        for (const d of days) {
          d.rows = d.rows.filter((r, idx) => idx < 4);
        }
      }

      return days;
    }

    function generatePlan({ daysCount, goal, experience, sessionLength, equipment, priority, weakPoint, guest }) {
      const library = getExerciseLibrary();
      const equipmentLabel = equipment === 'machines' ? 'Machines' : (equipment === 'dumbbells' ? 'Dumbbells' : (equipment === 'barbell' ? 'Barbell' : 'Mixed'));
      const sessionLabel = `~${sessionLength} min`;
      const context = { goal, experience, sessionLength, equipment, priority, weakPoint, library };

      const days = experience === 'intermediate'
        ? generateIntermediateSplit(daysCount, context)
        : generateBeginnerFullBody(daysCount, context);

      const goalLabel = goal === 'lose' ? 'Lose fat' : (goal === 'gain' ? 'Build muscle' : 'Maintain');
      const expLabel = experience === 'intermediate' ? 'Intermediate' : 'Beginner';

      return {
        title: `${daysCount}-Day Plan ‚Ä¢ ${goalLabel} ‚Ä¢ ${expLabel}`,
        createdAt: Date.now(),
        inputs: { daysCount, goal, experience, sessionLength, equipment, priority, weakPoint },
        meta: {
          guest: Boolean(guest),
          mode: guest ? 'Guest (not saved)' : 'Saved plan',
          equipmentLabel,
          sessionLabel
        },
        days
      };
    }

    function hydrateFromSavedPlan(user) {
      if (!user) return;
      const saved = getSavedPlan(user.email);
      if (!saved) {
        builderStatusEl.innerHTML = '<strong>Tip:</strong> Generate a plan, then save it so you can come back anytime.';
        clearPlanUI();
        return;
      }

      const inputs = saved.inputs || {};
      if (inputs.daysCount) daysEl.value = String(inputs.daysCount);
      if (inputs.goal) goalEl.value = String(inputs.goal);
      if (inputs.experience) experienceEl.value = String(inputs.experience);
      if (inputs.sessionLength) sessionLengthEl.value = String(inputs.sessionLength);
      if (inputs.equipment) equipmentEl.value = String(inputs.equipment);
      if (inputs.priority) priorityEl.value = String(inputs.priority);
      if (inputs.weakPoint) weakPointEl.value = String(inputs.weakPoint);

      builderStatusEl.textContent = 'Loaded your last saved plan.';
      renderPlan(saved);
    }

    function render() {
      const user = getUser();
      const guest = isGuest();

      if (!user && !guest) {
        showGate();
        gateStatusEl.textContent = '';
        return;
      }

      showBuilder();
      builderStatusEl.textContent = '';

      // In guest mode, keep things usable but unsaved.
      if (!user && guest) {
        saveEl.classList.add('btn-disabled');
        saveEl.setAttribute('aria-disabled', 'true');
        saveEl.disabled = true;
        logoutEl.textContent = 'Exit guest mode';
        builderStatusEl.innerHTML = '<strong>Guest mode:</strong> generate your plan and print it. Create a free account anytime to save.';
        clearPlanUI();
        return;
      }

      // Logged in
      saveEl.classList.remove('btn-disabled');
      saveEl.removeAttribute('aria-disabled');
      saveEl.disabled = false;
      logoutEl.textContent = 'Log out';
      hydrateFromSavedPlan(user);
    }

    function onSignup() {
      const email = String(signupEmailEl.value || '').trim();
      const name = String(signupNameEl.value || '').trim();

      if (!email) {
        gateStatusEl.innerHTML = '<strong>Heads up:</strong> please add your email to continue.';
        return;
      }

      if (!isValidEmail(email)) {
        gateStatusEl.innerHTML = '<strong>Heads up:</strong> please enter a valid email.';
        return;
      }

      setUser({
        email,
        name,
        createdAt: Date.now()
      });

      // Leaving guest mode if they create an account.
      setGuest(false);

      signupEmailEl.value = '';
      signupNameEl.value = '';
      gateStatusEl.textContent = '';
      render();
    }

    function onGuest() {
      setGuest(true);
      gateStatusEl.textContent = '';
      render();
    }

    function onLogout() {
      const user = getUser();
      if (user) {
        clearUser();
      }
      setGuest(false);
      clearPlanUI();
      builderStatusEl.textContent = '';
      render();
    }

    function onGenerate() {
      const user = getUser();
      const guest = isGuest();
      if (!user && !guest) {
        render();
        return;
      }

      const plan = generatePlan({
        daysCount: Number(daysEl.value),
        goal: goalEl.value,
        experience: experienceEl.value,
        sessionLength: Number(sessionLengthEl.value),
        equipment: equipmentEl.value,
        priority: priorityEl.value,
        weakPoint: weakPointEl.value,
        guest: !user
      });

      builderStatusEl.textContent = user
        ? 'Plan generated. If you like it, press Save plan.'
        : 'Plan generated (guest). Print it if you want a copy.';
      renderPlan(plan);
    }

    function onSave() {
      const user = getUser();
      if (!user) {
        builderStatusEl.innerHTML = '<strong>Heads up:</strong> create a free account to save plans. You can still print in guest mode.';
        return;
      }

      if (planEl.hidden) {
        builderStatusEl.innerHTML = '<strong>Heads up:</strong> generate a plan first, then save it.';
        return;
      }

      const plan = generatePlan({
        daysCount: Number(daysEl.value),
        goal: goalEl.value,
        experience: experienceEl.value,
        sessionLength: Number(sessionLengthEl.value),
        equipment: equipmentEl.value,
        priority: priorityEl.value,
        weakPoint: weakPointEl.value,
        guest: false
      });

      setSavedPlan(user.email, plan);
      builderStatusEl.textContent = 'Saved. You can come back to this page anytime to load it.';
      renderPlan(plan);
    }

    function onPrint() {
      if (planEl.hidden) {
        builderStatusEl.innerHTML = '<strong>Heads up:</strong> generate a plan first, then print it.';
        return;
      }
      window.print();
    }

    signupBtnEl.addEventListener('click', onSignup);
    guestBtnEl.addEventListener('click', onGuest);
    generateEl.addEventListener('click', onGenerate);
    saveEl.addEventListener('click', onSave);
    printEl.addEventListener('click', onPrint);
    logoutEl.addEventListener('click', onLogout);

    render();
  </script>
  <script src="/scripts/cookie-consent.js"></script>
</body>
</html>
